window.params=paramsToJson(location.search.substring(1));window.infos={};window.randomId=randomId();window.warsawTimeoutTrataErroInstalacao=60000;$.ajax({method:"GET",url:"../../gas/validacao/infos",data:{randomId:window.randomId},success:function(a){infos=a;analisarPlugin(infos.pluginType)},error:function(a){validar({codigoErro:"GAS003"})}});function randomId(){return Math.floor(new Date().valueOf()*Math.random())}function validar(a){a.urlRetorno=window.params.urlRetorno;a.randomId=window.randomId;$.ajax({method:"POST",data:$.param(a),url:"../../gas/validacao/validar",success:function(b){window.location=b.urlRedirect},error:function(b){falhou()}})}function falhou(){$(".animacao").removeClass("animacao");$("#aguarde").hide();$("#falha").show()}function doGBBD(){console.log("gbbd");try{GbPluginObjIe.Ativa();validar({versao:GbPluginObjIe.Versao,f10:GbPluginObjIe.Function10("","","","PF",getChave())})}catch(a){validar({codigoErro:"GBBD001",descricaoErro:a.message})}}function doGBAS(){console.log("gbas");try{var a=document.getElementById("jmid");validar({f10:a.Function10("1500","","","","PF",getChave())})}catch(b){validar({codigoErro:"GBAS001",descricaoErro:b.message})}}function analisarPlugin(f){switch(f){case"NAO_SUPORTADO":validar({codigoErro:"GAS001"});return;case"WS":var b=function(e){console.log("ws-ok");console.log(e);validar(e)};var i=function(e){console.log("ws-falha");console.log(e);validar(e)};var d=true;var g=null;try{g=new WebSocket("wss://127.0.0.1:30900")}catch(c){d=false}if(g==undefined||g.readyState===3){d=false}else{g.close()}var h=getTrataErroInstalacao()!=undefined&&getTrataErroInstalacao()===false&&d===false;if(!h){window.warsawTimeoutTrataErroInstalacao=4000}warsawCheck(getSeedWarsaw(),b,i);return;case"GBAS":if(!checkJava()){validar({codigoErro:"GBAS001"});return}window.gbasCallback=function(){try{var k=document.getElementById("jmid").getStatus();switch(k){case 0:break;case 1:case 3:clearTimeout(window.gbasTimeout);doGBAS();break;case 2:case 4:default:throw"gbas com status de erro: "+k}}catch(l){clearTimeout(window.gbasTimeout);validar({codigoErro:"GBAS002",descricaoErro:l})}};var j=getContextPath()=="/"?"":getContextPath();$("#gbasapplet").html("<applet id='jmid' archive='"+j+"/gcs/statics/gas/gbas/GbAs.jar' code='br/com/gas/mid/GbAs.class' height='1' width='1' MAYSCRIPT><param value='"+getSeedGBAS()+"' name='seed'></param><param value='gbasCallback' name='statusChangeCallback'></param></applet>");var a=15000;window.gbasTimeout=setTimeout(function(){try{var k=document.getElementById("jmid").getStatus();switch(k){case 1:case 3:doGBAS();break;case 0:case 2:case 4:default:throw"gbas com status de erro: "+k}}catch(l){validar({codigoErro:"GBAS002",descricaoErro:l})}},a);return;case"GBBD":doGBBD();return;default:validar({codigoErro:"GAS002",descricaoErro:"tipo de plugin desconhecido: "+f});return}}function getChave(){return infos.chave}function getInfoCMD(){return infos.infoCMD}function getF10CMD(){return infos.F10CMD}function getSeedGBAS(){return infos.seedGBAS}function getSeedWarsaw(){return infos.seedWarsaw}function getContextPath(){return infos.contextPath}function getTrataErroInstalacao(){return infos.trataErroInstalacao}function paramsToJson(e){var h={};var d=e.split("&");for(var b in d){var f=d[b].trim();if(f.length>0){var a=f.split("=");var c=a[0];var g=null;if(a.length>1){g=a[1]}else{g=true}h[c]=g}}return h}function checkJava(){var a=deployJava.getJREs();if(a[0]){return true}else{if(typeof navigator.javaEnabled!=="function"){return false}else{if(navigator.javaEnabled()){return false}else{return plugins.some(function(b){return b&&String(b.name).toLowerCase().indexOf("java")>-1})}}}};